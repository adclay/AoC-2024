from Puzzle_Input import *
ex_warehouse = np.array(list('######################....[]....[]..[]####............[]..####..[][]....[]..[]####....[]@.....[]..####[]##....[]......####[]....[]....[]..####..[][]..[]..[][]####........[]......######################'), dtype = str).reshape((10, 20))
warehouse = np.array(list('######################################################################################################[][][]##....[]..[]##[]##......##..[]..[][]..............................[][]..........[]........####[]##[]......##......##......[]........................[][]..##......[][]....[]....[][]......[]..####....[]........[]##..[]....[]..[]....[]##[]####..[][]....[]....................##[]........[][]..####......[]##..[][][]..[]..[]..[]............[]..[][]..[]....##..[]..[][]##[]..##[][]..[]..[]##....####[][]....[]........[]........##........[][]##[][]....[]....[][]....[]..........##[]..[]....[]..[]####[]..........##..[]..[]......##....[][]..............[][]........[]..##[]..[]....##....[]....[]..####....[][]..[]..##[]..[]..[]....####[]....[]##[][]........##..[]....[]......[]..[][]....##[][][]######........[][]......[][]....[]....[]..##..[][][]....[]....##[]........[][]##[]....[]....##..[]....####........[][]..##......[]##....[]......##..........[]............##..........##..........##..[]..####....[]..........[]..[]..[]....[]........[][]##..[]..##..[]............##....##[]..[]....[][]....####..##....[][]........[]................[]..##........[][]......##..[]..[][]......[]..............####[][]......[][]..[][]......##..[][][]................[]##......[]..##..[][]........[][]......[][]####..[]....[]....[][]..[][][][]........##....[]..##[][]..[]....[]##..............[]..##........########[]......[]..............[][]........##............[][]..[]..##[]..[]....[]..[]..[]..##....[]..[]####[][]##[][]........##[]......[]##........##......[][][]..[]..[]....[]....##......[]..[]##[]....[]####........[][][]##[][]..............##..[][]........##......[]....##..[]......##..[]..............####[][][][]........[]......[]..[][][][]..........[][]..............[]##....[]..[][]..........[]..[]####....##....[]..##..[]....[][]..[][][][]......[][]##......[][][]......[]..####..[]##..[]....[][][]####[]............[]....[]##......##........[]......[]..[][]........[]..[]........[][]....##........####..........[][][]....[]..[]............[]......##......[]......................##..[][]....##[]..####......##..........[]..[]....##[]##........[]..##[]##....[]##........[]....[]........##[][][]##############[]..........[]......[]..##..............[]..[]..[]......[]..........[]..[]......[]......[]####[]......[]......[]..[][]..[]..........[]..[]............[]..####..##[]##..[]..........[]....[][]####......##....##......##......[][]....##[][]..[]@...[]............[]........................[][]..####[]................[][][]..[]..[]..[]....##....##[]......[]..[]....##..[][]......##..[][]....##..####..[]..##....[]......[]......[][]......##....[][][]............[][]..##[]##............[]..[][]..####..[]......[][]##[]......[]....[]............[]....##[]........[]..........[]....[]....[]..[]....####..[]....[]......[]....##....[][]..........[]....[]..................[]##......##[]##....[][]..######..........[]....##....####................[]..##....##......[]....####....[][]..........[]......####..[]....[]##......##..........[]..[]##........[][][]..##....##..[][]....[]....[][]..[][][]......####..##[][]....[]......[]..........[]..[]##..........####....[]..[]##..[]..[]........[]........##..####........##....##..........##[]..##....[]....##............[]....[]..........[][]##....[]##..[][]####........[]..[]......##[][]......##[]..[]....[]....................[][]....##[]........[]....[]######[]......##....##..........[]..............[]..[]..[]........[]..[]..[]....[]..[]..##......##########..[][]................##..##....................##....[]........[][]##....##[]..[]..........[]..####..##....[]..[]........[][]........##[]..............##..[]....[]..##[]..[]....[][]##............####[]......[]..........[]..[][]##......##[]..[]..[]..........[]....[][][]....[]####..[]......[]....####[]......[][]..##[]##..[]....[]....[]......[]..[]............[]....####........................######[]..[]..##......................[][]..........[][]......[]..[]............##[]..[][]........[][]####......[][]......[][]##..[]....[]..[]......[]....[][]............[]..............[]..[]..[][]....####..##........[]....[]....[]......[]..............##......[]..##[]....[]....[]..[]..[]............####[]........[]............[]##..[]............####..........##..........[]..[]..[]##[]............####..[][]..[][]....[]............[][][][]....[]##..[]......[]..[]............##..........[][]....[]####..[]............[]..[]..[][]..[]....##....[]........[]..........##........[]..##..[][]##......[]####..[]....##........##......[]............##..[]..........[][]..[]..........[]..........[]........####..##....[][]..........##..........##[]..[]..##[]............[]............[][]........[][][]..[]####....[][]..[]........[]......[]..[]............[]..[]..[][]......##..........[]..............[]..####....[]....[]......##..[]..[]##................[][]........[]......[]..[][]......##..............######################################################################################################'), dtype = str).reshape((50, 100))

""" -----------------------------------------------------------------------------------------------|
|                                              Part 2                                              |
|----------------------------------------------------------------------------------------------- """

pos = np.array(np.where(warehouse == '@')).reshape((2,))
for move in moves:
    if move == '^':
        direction = np.array([-1, 0])
    elif move == '<':
        direction = np.array([0, -1])
    elif move == 'v':
        direction = np.array([1, 0])
    else:
        direction = np.array([0, 1])
    next_move = direction.copy()
    
    old_boxes, new_boxes, bad_move = np.empty((0, 2), dtype = int), pos.copy().reshape((1, 2)), False
    while new_boxes.shape[0] > 0:
        num_new_boxes = new_boxes.shape[0]
        old_boxes, new_boxes = np.append(old_boxes, new_boxes, axis = 0), np.empty((0, 2), dtype = int)
        for box in old_boxes[-num_new_boxes :]:
            if warehouse[tuple(box + direction)] == '#':
                bad_move = True
                break
            if warehouse[tuple(box + direction)] != '.':
                this_half = box + direction
                if not np.equal(new_boxes, this_half).all(1).any() and not np.equal(old_boxes, this_half).all(1).any():
                    new_boxes = np.append(new_boxes, this_half.reshape((1, 2)), axis = 0)
                    if warehouse[tuple(box + direction)] == '[':
                        other_half = this_half + np.array([0, 1])
                    else:
                        other_half = this_half - np.array([0, 1])
                    if not np.equal(new_boxes, other_half).all(1).any() and not np.equal(old_boxes, other_half).all(1).any():
                        new_boxes = np.append(new_boxes, other_half.reshape((1, 2)), axis = 0)
        if bad_move:
            break

    if not bad_move:
        for box in old_boxes[::-1]:
            warehouse[tuple(box + direction)], warehouse[tuple(box)] = warehouse[tuple(box)], '.'
        pos += direction

GPS = 0
for y in range(warehouse.shape[0]):
    for x in range(warehouse.shape[1]):
        if warehouse[y, x] == '[':
            GPS += 100 * y + x
print("Answer to part 2 =", GPS)
